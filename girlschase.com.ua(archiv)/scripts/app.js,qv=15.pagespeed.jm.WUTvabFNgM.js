$(document).ready(function(){$('a[href="#"]').click(function(e){e.preventDefault();});$('.menu-mobile').on('click',function(){$(this).toggleClass('open');$('.m_header .menu').toggleClass('open');});$('.lead-carousel').slick({arrows:false,dots:true,fade:true});if($('#map').length){var point=$('body').data('coords').split(',').map(function(e){return+e;});ymaps.ready(function(){var myMap=new ymaps.Map('map',{center:point,zoom:18,controls:['zoomControl']},{searchControlProvider:'yandex#search'}),myPlacemark=new ymaps.Placemark(myMap.getCenter(),{},{iconLayout:'default#image',iconImageHref:'/static/images/marker.png',iconImageSize:[290,119],iconImageOffset:[0,-49]});myMap.geoObjects.add(myPlacemark);myMap.behaviors.disable('scrollZoom');});}function form(){var form=$('.m_form');var screen=$(window).height();var header=$('.m_header').height();var footer=$('.m_footer').height();var summ=header+footer;if(screen>summ){var mih=screen-summ;form.css('min-height',mih)}};form();if(typeof waitForImages==='undefined'){waitForImages=function(callback,errCallback,selector,timeout){if(!selector)selector='img';if(!timeout)timeout=15000;var imgPromise=new Promise(function(resolve,reject){var imgs=document.querySelectorAll(selector);var imgsCount=imgs.length;var imgsLoadCount=0;imgs.forEach(function(img){if(img.complete){imgsLoadCount++;}else{img.addEventListener('load',function(){imgsLoadCount++;if(imgsCount==imgsLoadCount){resolve();}});img.addEventListener('error',function(){reject();})}});if(imgsCount==imgsLoadCount){resolve();}setTimeout(function(){reject();},timeout);});imgPromise.then(function(result){callback();},function(err){errCallback();});};}var inp;var countPhotos=0;$(document).on('change','.inp-field',function(e){var input=$(this);var status=input.val();if(status==""){}else{if(input.get(0).files&&input.get(0).files[0]){var filesCount=input.get(0).files.length;console.log(filesCount);var doneFilesCount=0;var imgPromise=new Promise(function(resolve,reject){for(var i=0;i<filesCount;i++){var reader=new FileReader();(function(i,countPhotos){reader.onload=function(e){$('.jspPane').append('<img id="photo-'+(i+countPhotos)+'" src="'+e.target.result+'" alt="your image" class="img">');var img=$('#photo-'+(i+countPhotos));img.resizecrop({width:46,height:46,vertical:"top",callback:function(){doneFilesCount+=1;console.log(doneFilesCount);if(filesCount==doneFilesCount)resolve();}});img.after('<div class="daw"></div>');}})(i,countPhotos);reader.readAsDataURL(input.get(0).files[i]);}setTimeout(function(){reject();},15000);});imgPromise.then(function(result){var elem=$('.fileUpload').jScrollPane({verticalDragMinHeight:40,verticalDragMaxHeight:40,});var api=elem.data('jsp');api.destroy();$('.fileUpload').jScrollPane({verticalDragMinHeight:40,verticalDragMaxHeight:40,});},function(err){alert('error');});countPhotos=countPhotos+filesCount;if($('.remove-photo')){$('.remove-photo').remove();}$('.row .attach').after('<a href="#" class="remove-photo">РЈРґР°Р»РёС‚СЊ РІСЃРµ</a></div>');}$('.img').css('display','inline-block');$('.row.photos').css('display','block');input.css('display','none');inp=input.detach();$('.detached-inputs-cont').append(inp);$('.attach label span').after('<input name="file[]" multiple class="inp-field" type="file" data-validation="mime size" data-validation-allowing="jpg, png, gif" data-validation-max-size="2M" value="" data-validation-error-msg-container="#file-error-dialog">');$('.attach label span').text('РџСЂРёРєСЂРµРїРёС‚СЊ РµС‰Рµ');}});if($('.fileUpload').length){$('.fileUpload').jScrollPane({verticalDragMinHeight:40,verticalDragMaxHeight:40,});}$(document).on('click','.remove-photo',function(e){e.preventDefault();$('.detached-inputs-cont').children().remove();$('.row.photos').css('display','none');$('.attach label span').text('РџСЂРёРєСЂРµРїРёС‚Рµ С„РѕС‚РѕРіСЂР°С„РёРё');$(this).remove();$('span.img').remove();});function modal(){$('.popup-with-zoom-anim').magnificPopup({type:'inline',fixedContentPos:false,fixedBgPos:true,overflowY:'auto',closeBtnInside:true,preloader:false,midClick:true,removalDelay:300,mainClass:'my-mfp-zoom-in'});};modal();$(document).on('click','.popup-modal-dismiss',function(e){e.preventDefault();$.magnificPopup.close();});function validateForm(){$('.modal .submit').on('click',function(){var valid=true,message='';$('form input').each(function(){var $this=$(this);if(!$this.val()){var inputName=$this.attr('name');valid=false;$(this).addClass('error');}});if(!valid){return false}else{$('#success').trigger('click');}});$('.modal .text').on('focus',function(){$(this).removeClass('error');});};validateForm();$.validate({lang:'ru',modules:'file',validateOnBlur:false,showHelpOnFocus:false,borderColorOnError:'#f3b700',onError:function($form){},onSuccess:function($form){var response=grecaptcha.getResponse();if(response.length==0){return false;}$('body').animate({'scrollTop':0},'slow');if(countPhotos!=0){$('#modal-loader').css('display','block');}},});$('input[name="name"], input[name="email"], input[name="phone"], input[name="city"]').on('click',function(e){$(this).parent().removeClass('has-error');$(this).css('border-color','#e1dfbd');});$('form').ajaxForm({success:function(response,statusText,xhr,form){if(countPhotos!=0){setTimeout(function(){$('#modal-loader').css('display','none');$('#modal-form-sent').css('display','block');},3000);}else{$('#modal-form-sent').css('display','block');}},error:function(){alert('Р’ РїСЂРѕС†РµСЃСЃРµ РѕС‚РїСЂР°РІРєРё РїСЂРѕРёР·РѕС€Р»Р° РѕС€РёР±РєР°');},});var readmoreShow="Р§РёС‚Р°С‚СЊ РїРѕР»РЅРѕСЃС‚СЊСЋ",readmoreHide="РЎРєСЂС‹С‚СЊ";$('.showmore').on('click',function(){var readmoreThis=$(this);readmoreThis.text(readmoreThis.text()==readmoreShow?readmoreHide:readmoreShow);readmoreThis.parent().prev().toggle();});});